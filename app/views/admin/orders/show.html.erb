<div class="container">
  <div class="row">
    <div class="mx-auto col-12">
      <h4 class="text-center bg-light col-4 mt-3 mb-3 offset-1">注文履歴詳細</h4>
      <%= form_with model: @order, url: {controller: 'orders', action: 'update' }, local:true do |f| %>
      <div class="row">
        <div>購入者</div>
        <% name = @order.customer.last_name + " " + @order.customer.first_name %>
        <div><%= link_to name, admin_customer_path(@order.customer.id) %></div>
      </div>
      <div class="row">
        <div>注文日</div>
        <div><%= @order.created_at.strftime('%Y/%m/%d') %></div>
      </div>
      <div class="row">
        <div>配送先</div>
        <div>
          <%= @order.delivery_postal_code %> <%= @order.delivery_address %><br>
          <%= @order.delivery_name %>
        </div>
      </div>
      <div class="row">
        <div>支払方法</div>
        <div><%= @order.payment_method %></div>
      </div>
      <div class="row">
        <div>注文ステータス</div>
        <div><%= f.select :status, options_for_select(Order.statuses) %><%= f.submit '更新', class: 'btn btn-success offset-3' %></div>
      </div>
      <% end %>

      <table class="table">
        <tablehead>
          <tr>
            <td class="table-active">商品名</td>
            <td class="table-active">単価（税込）</td>
            <td class="table-active">数量</td>
            <td class="table-active">小計</td>
            <td class="table-active">製作ステータス</td>
            <td></td>
          </tr>
        </tablehead>
        <tablebody>
          <% @order_items.each do |order_item| %>
            <%= form_with model: order_item, url: {controller: 'order_items', action: 'update' }, local:true do |f| %>
            <tr>
              <td><%= order_item.item.name %></td>
              <td><%= order_item.order_unit_price %></td>
              <td><%= order_item.amount %></td>
              <td><%= order_item.order_price %></td>
              <td><%= f.select :making_status, options_for_select(OrderItem.making_statuses) %><%= f.submit '更新', class: 'btn btn-success offset-3' %></td>
            </tr>
            <% end %>
          <% end %>
        </tablebody>
        <table>
          <tablebody>
            <tr>
              <td>商品合計</td>
              <td><%= @order_unit_price.to_s(:delimited, delimiter: ',') %></td>
            </tr>
            <tr>
              <td>送料</td>
              <td><%= @order.postage.to_s(:delimited, delimiter: ',') %></td>
            </tr>
            <tr>
              <td>請求金額合計</td>
              <td><%= @order.charge.to_s(:delimited, delimiter: ',') %></td>
            </tr>
          </tablebody>
        </table>
      </table>
    </div>
  </div>
</div>